<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allergen Atlas - Questionnaire</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        img.logo { max-width: 150px; display: block; margin: auto; }
        form { display: flex; flex-direction: column; }
        label { margin-top: 10px; }
        button { margin-top: 20px; padding: 10px; background: orange; border: none; color: white; font-size: 16px; cursor: pointer; }
        .privacy-note { font-size: 0.9em; margin-top: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <img src="logo.jpg" alt="Allergen Atlas Logo" class="logo">
    <h1>Allergy Information</h1>
    <form id="page2Form">
        <p>Do you suffer with a food allergy or intolerance?</p>
        <label><input type="radio" name="hasAllergy" value="Yes" required> Yes</label>
        <label><input type="radio" name="hasAllergy" value="No" required> No</label>

        <div id="allergyList">
            <p>Which one(s)?</p>
            <label><input type="checkbox" name="allergies" value="Peanuts"> Peanuts</label>
            <label><input type="checkbox" name="allergies" value="Tree nuts"> Tree nuts (almonds, walnuts, cashews, etc.)</label>
            <label><input type="checkbox" name="allergies" value="Milk"> Milk</label>
            <label><input type="checkbox" name="allergies" value="Eggs"> Eggs</label>
            <label><input type="checkbox" name="allergies" value="Fish"> Fish (salmon, tuna, cod, etc.)</label>
            <label><input type="checkbox" name="allergies" value="Shellfish"> Shellfish (shrimp, crab, lobster)</label>
            <label><input type="checkbox" name="allergies" value="Soy"> Soy</label>
            <label><input type="checkbox" name="allergies" value="Wheat"> Wheat</label>
            <label><input type="checkbox" id="somethingElse" name="allergies" value="Something else"> Something else</label>
            <textarea id="somethingElseText" name="somethingElseText" maxlength="250" class="hidden" placeholder="Please specify (max 250 chars)"></textarea>
        </div>

        <p>Do you carry an epi-pen?</p>
        <label><input type="radio" name="epiPen" value="Yes" required> Yes</label>
        <label><input type="radio" name="epiPen" value="No" required> No</label>

        <button type="submit">Submit</button>
    </form>
    <p class="privacy-note"><a href="privacy.html" target="_blank">Privacy Policy</a></p>

    <script>
        const somethingElseCheckbox = document.getElementById('somethingElse');
        const somethingElseText = document.getElementById('somethingElseText');
        somethingElseCheckbox.addEventListener('change', function() {
            somethingElseText.classList.toggle('hidden', !this.checked);
        });

        document.getElementById('page2Form').addEventListener('submit', function(e) {
            e.preventDefault();
            const page1Data = JSON.parse(localStorage.getItem('page1Data'));
            const formData = new FormData(e.target);
            const allergies = Array.from(document.querySelectorAll('input[name="allergies"]:checked')).map(el => el.value);
            const allData = { ...page1Data,
                hasAllergy: formData.get('hasAllergy'),
                allergies: allergies.join(', '),
                somethingElseText: formData.get('somethingElseText') || '',
                epiPen: formData.get('epiPen')
            };
            
            fetch('https://script.google.com/macros/s/AKfycbwHM8NLdiJyIli-yz78ProJ3JxWM3bM3kalhSlw1rB3ImMaeEC_L2yWVR-HJ8bn68ei6w/exec', {
                method: 'POST',
                mode: 'no-cors',
                body: new URLSearchParams(allData)
            }).then(() => {
                window.location.href = 'thankyou.html';
            }).catch(err => {
                alert('Submission failed, please try again.');
                console.error(err);
            });
        });
    </script>
</body>
</html>
